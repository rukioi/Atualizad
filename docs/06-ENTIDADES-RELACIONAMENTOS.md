
# üìä ESTRUTURA DE ENTIDADES E RELACIONAMENTOS

## üèóÔ∏è VIS√ÉO GERAL DA ARQUITETURA MULTI-TENANT

O sistema jur√≠dico SaaS utiliza **isolamento por schema** onde cada tenant possui seu pr√≥prio namespace no PostgreSQL, garantindo total separa√ß√£o de dados.

### üìã ENTIDADES PRINCIPAIS

#### **üè¢ TENANT (Schema Global)**
```sql
CREATE TABLE tenants (
  id UUID PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  schema_name VARCHAR(100) UNIQUE,
  plan_type VARCHAR(50) DEFAULT 'basic',
  is_active BOOLEAN DEFAULT true,
  max_users INTEGER DEFAULT 5,
  max_storage BIGINT DEFAULT 1073741824,
  plan_expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### **üë§ USER (Schema Global)**
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  password VARCHAR(255),
  name VARCHAR(255),
  account_type ENUM('SIMPLES', 'COMPOSTA', 'GERENCIAL'),
  tenant_id UUID REFERENCES tenants(id),
  is_active BOOLEAN DEFAULT true,
  must_change_password BOOLEAN DEFAULT false,
  last_login TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### **üèõÔ∏è ADMIN_USER (Schema Global)**
```sql
CREATE TABLE admin_users (
  id UUID PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  password VARCHAR(255),
  name VARCHAR(255),
  role VARCHAR(50) DEFAULT 'admin',
  is_active BOOLEAN DEFAULT true,
  last_login TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## üóÉÔ∏è ENTIDADES POR TENANT (Schema Isolado)

### **üë• CLIENT (tenant_{id}.clients)**
```sql
CREATE TABLE clients (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  email VARCHAR(255),
  phone VARCHAR(50),
  mobile VARCHAR(50), -- Campo adicional do UI
  organization VARCHAR(255),
  address JSONB DEFAULT '{}', -- Estrutura: {street, city, state, zipCode, country}
  budget DECIMAL(15,2),
  currency VARCHAR(3) DEFAULT 'BRL',
  status VARCHAR(50) DEFAULT 'active',
  level VARCHAR(100), -- Campo do UI: Premium, VIP, etc.
  tags JSONB DEFAULT '[]',
  notes TEXT,
  description TEXT, -- Campo adicional do UI
  
  -- Campos espec√≠ficos do Brasil (ausentes no documento original)
  cpf VARCHAR(20),
  rg VARCHAR(20),
  pis VARCHAR(20), -- NOVO: Campo identificado no UI
  cei VARCHAR(20), -- NOVO: Campo identificado no UI
  professional_title VARCHAR(255),
  marital_status VARCHAR(50),
  birth_date DATE,
  inss_status VARCHAR(50), -- NOVO: Campo do UI
  
  -- Campos financeiros adicionais
  amount_paid DECIMAL(15,2) DEFAULT 0, -- NOVO: Valor j√° pago
  referred_by VARCHAR(255), -- NOVO: Indicado por
  registered_by VARCHAR(255), -- NOVO: Cadastrado por
  
  -- Auditoria
  created_by VARCHAR(255) NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- √çndices para performance
CREATE INDEX idx_clients_name ON clients(name);
CREATE INDEX idx_clients_email ON clients(email);
CREATE INDEX idx_clients_status ON clients(status);
CREATE INDEX idx_clients_cpf ON clients(cpf);
CREATE INDEX idx_clients_active ON clients(is_active);
```

### **üìÅ PROJECT (tenant_{id}.projects)**
```sql
CREATE TABLE projects (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL, -- NOVO: Campo separado identificado no UI
  description TEXT,
  client_id UUID, -- FK para clients
  client_name VARCHAR(255),
  organization VARCHAR(255), -- NOVO: Campo do UI
  address TEXT, -- NOVO: Endere√ßo do projeto
  budget DECIMAL(12,2),
  estimated_value DECIMAL(12,2), -- NOVO: Valor estimado separado
  currency VARCHAR(3) DEFAULT 'BRL',
  status VARCHAR(50) DEFAULT 'proposal',
  priority VARCHAR(20) DEFAULT 'medium',
  progress INTEGER DEFAULT 0,
  start_date DATE,
  end_date DATE,
  due_date DATE, -- NOVO: Data de vencimento
  completed_at TIMESTAMPTZ, -- NOVO: Data de conclus√£o
  tags JSONB DEFAULT '[]',
  assigned_to JSONB DEFAULT '[]', -- NOVO: Array de respons√°veis
  notes TEXT,
  
  -- NOVO: Contatos do projeto (estrutura complexa do UI)
  contacts JSONB DEFAULT '[]', -- [{id, name, email, phone, role}]
  
  -- Auditoria
  created_by VARCHAR(255) NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- FK Constraints
  CONSTRAINT fk_project_client FOREIGN KEY (client_id) REFERENCES clients(id)
);

-- √çndices
CREATE INDEX idx_projects_title ON projects(title);
CREATE INDEX idx_projects_status ON projects(status);
CREATE INDEX idx_projects_client_id ON projects(client_id);
CREATE INDEX idx_projects_priority ON projects(priority);
```

### **‚úÖ TASK (tenant_{id}.tasks)**
```sql
CREATE TABLE tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  project_id UUID, -- FK para projects
  project_title VARCHAR(255),
  client_id UUID, -- FK para clients
  client_name VARCHAR(255),
  assigned_to VARCHAR(255) NOT NULL,
  status VARCHAR(50) DEFAULT 'not_started',
  priority VARCHAR(20) DEFAULT 'medium',
  progress INTEGER DEFAULT 0,
  start_date DATE,
  end_date DATE,
  due_date DATE, -- NOVO: Campo espec√≠fico do UI
  completed_at TIMESTAMPTZ,
  
  -- NOVO: Campos de horas (identificados no UI)
  estimated_hours DECIMAL(5,2),
  actual_hours DECIMAL(5,2),
  
  tags JSONB DEFAULT '[]',
  notes TEXT,
  
  -- NOVO: Subtarefas (estrutura complexa do UI)
  subtasks JSONB DEFAULT '[]', -- [{id, title, completed, createdAt, completedAt}]
  
  -- Auditoria
  created_by VARCHAR(255) NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- FK Constraints
  CONSTRAINT fk_task_project FOREIGN KEY (project_id) REFERENCES projects(id),
  CONSTRAINT fk_task_client FOREIGN KEY (client_id) REFERENCES clients(id)
);

-- √çndices
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_assigned_to ON tasks(assigned_to);
CREATE INDEX idx_tasks_project_id ON tasks(project_id);
CREATE INDEX idx_tasks_priority ON tasks(priority);
```

### **üí∞ TRANSACTION (tenant_{id}.transactions)**
```sql
CREATE TABLE transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  description VARCHAR(255) NOT NULL,
  amount DECIMAL(12,2) NOT NULL,
  type VARCHAR(20) NOT NULL CHECK (type IN ('income', 'expense')),
  category_id VARCHAR(255),
  category VARCHAR(100),
  date DATE NOT NULL,
  payment_method VARCHAR(50),
  status VARCHAR(20) DEFAULT 'confirmed',
  project_id UUID, -- FK para projects (opcional)
  project_title VARCHAR(255),
  client_id UUID, -- FK para clients (opcional)
  client_name VARCHAR(255),
  tags JSONB DEFAULT '[]',
  notes TEXT,
  
  -- NOVO: Campos de recorr√™ncia (identificados no UI)
  is_recurring BOOLEAN DEFAULT FALSE,
  recurring_frequency VARCHAR(20), -- monthly, quarterly, yearly
  
  -- Auditoria
  created_by VARCHAR(255) NOT NULL,
  last_modified_by VARCHAR(255), -- NOVO: √öltima modifica√ß√£o
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- FK Constraints
  CONSTRAINT fk_transaction_project FOREIGN KEY (project_id) REFERENCES projects(id),
  CONSTRAINT fk_transaction_client FOREIGN KEY (client_id) REFERENCES clients(id)
);

-- √çndices
CREATE INDEX idx_transactions_type ON transactions(type);
CREATE INDEX idx_transactions_date ON transactions(date);
CREATE INDEX idx_transactions_category ON transactions(category_id);
CREATE INDEX idx_transactions_status ON transactions(status);
```

### **üßæ INVOICE (tenant_{id}.invoices)**
```sql
CREATE TABLE invoices (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  number VARCHAR(50) NOT NULL UNIQUE,
  title VARCHAR(255) NOT NULL, -- NOVO: Campo do UI
  client_id UUID, -- FK para clients
  client_name VARCHAR(255),
  client_email VARCHAR(255), -- NOVO: Campos espec√≠ficos do cliente
  client_phone VARCHAR(50), -- NOVO: Para notifica√ß√µes
  project_id UUID, -- NOVO: FK para projects (opcional)
  project_name VARCHAR(255), -- NOVO: Nome do projeto
  amount DECIMAL(12,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'BRL',
  due_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  description TEXT,
  
  -- NOVO: Estrutura de itens (identificada no UI)
  items JSONB DEFAULT '[]', -- [{id, description, quantity, rate, amount, tax}]
  
  notes TEXT,
  
  -- NOVO: Campos de pagamento (UI de receb√≠veis)
  payment_status VARCHAR(20) DEFAULT 'pending',
  payment_method VARCHAR(50),
  payment_date DATE,
  
  -- NOVO: Campos de notifica√ß√£o/cobran√ßa
  email_sent BOOLEAN DEFAULT FALSE,
  email_sent_at TIMESTAMPTZ,
  reminders_sent INTEGER DEFAULT 0,
  last_reminder_at TIMESTAMPTZ,
  
  -- NOVO: Integra√ß√£o Stripe (UI de receb√≠veis)
  stripe_invoice_id VARCHAR(255),
  stripe_payment_intent_id VARCHAR(255),
  link_pagamento TEXT, -- NOVO: Link do Stripe
  
  -- NOVO: Recorr√™ncia (UI permite faturas recorrentes)
  recorrente BOOLEAN DEFAULT FALSE,
  intervalo_dias INTEGER,
  proxima_fatura_data DATE,
  
  -- Auditoria
  created_by VARCHAR(255) NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- FK Constraints
  CONSTRAINT fk_invoice_client FOREIGN KEY (client_id) REFERENCES clients(id),
  CONSTRAINT fk_invoice_project FOREIGN KEY (project_id) REFERENCES projects(id)
);

-- √çndices
CREATE INDEX idx_invoices_number ON invoices(number);
CREATE INDEX idx_invoices_status ON invoices(status);
CREATE INDEX idx_invoices_due_date ON invoices(due_date);
CREATE INDEX idx_invoices_client_id ON invoices(client_id);
```

### **üìã PUBLICATION (tenant_{id}.publications)**
```sql
CREATE TABLE publications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR(255) NOT NULL, -- FK para user (isolamento por usu√°rio)
  oab_number VARCHAR(50) NOT NULL,
  process_number VARCHAR(100),
  publication_date DATE NOT NULL,
  content TEXT NOT NULL,
  source VARCHAR(50) NOT NULL CHECK (source IN ('CNJ-DATAJUD', 'Codilo', 'JusBrasil')),
  external_id VARCHAR(255),
  status VARCHAR(20) DEFAULT 'novo' CHECK (status IN ('novo', 'lido', 'arquivado')),
  
  -- NOVO: Campos adicionais do UI
  urgencia VARCHAR(20) DEFAULT 'media', -- alta, media, baixa
  responsavel VARCHAR(255), -- Respons√°vel pela publica√ß√£o
  vara_comarca VARCHAR(255), -- NOVO: Vara/Comarca (campo do UI)
  nome_pesquisado VARCHAR(255), -- NOVO: Nome pesquisado (campo do UI)
  diario VARCHAR(255), -- NOVO: Di√°rio oficial (campo do UI)
  
  -- NOVO: Atribui√ß√£o (funcionalidade do UI)
  atribuida_para_id VARCHAR(255), -- ID do usu√°rio atribu√≠do
  atribuida_para_nome VARCHAR(255), -- Nome do usu√°rio atribu√≠do
  data_atribuicao TIMESTAMPTZ,
  
  metadata JSONB DEFAULT '{}',
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(user_id, external_id)
);

-- √çndices
CREATE INDEX idx_publications_user_id ON publications(user_id);
CREATE INDEX idx_publications_status ON publications(status);
CREATE INDEX idx_publications_date ON publications(publication_date);
CREATE INDEX idx_publications_oab ON publications(oab_number);
```

### **üè∑Ô∏è CATEGORY (tenant_{id}.categories)**
```sql
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  type VARCHAR(20) NOT NULL CHECK (type IN ('income', 'expense')),
  color VARCHAR(7) DEFAULT '#000000',
  description TEXT,
  is_active BOOLEAN DEFAULT true,
  created_by VARCHAR(255),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### **üîî NOTIFICATION (tenant_{id}.notifications) - NOVA ENTIDADE**
```sql
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR(255) NOT NULL, -- Isolamento por usu√°rio
  title VARCHAR(255) NOT NULL,
  message TEXT NOT NULL,
  type VARCHAR(50) DEFAULT 'info', -- info, success, warning, error
  priority VARCHAR(20) DEFAULT 'normal', -- low, normal, high, urgent
  is_read BOOLEAN DEFAULT FALSE,
  action_url VARCHAR(500), -- URL para a√ß√£o relacionada
  metadata JSONB DEFAULT '{}',
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- √çndices
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_read ON notifications(is_read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at);
```

### **üìä DASHBOARD_METRIC (tenant_{id}.dashboard_metrics) - NOVA ENTIDADE**
```sql
CREATE TABLE dashboard_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  metric_name VARCHAR(100) NOT NULL,
  metric_value DECIMAL(15,2),
  metric_type VARCHAR(50), -- financial, count, percentage
  period_start DATE,
  period_end DATE,
  metadata JSONB DEFAULT '{}',
  calculated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### **üìé ATTACHMENT (tenant_{id}.attachments) - NOVA ENTIDADE**
```sql
CREATE TABLE attachments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  entity_type VARCHAR(50) NOT NULL, -- client, project, task, invoice, etc.
  entity_id UUID NOT NULL,
  file_name VARCHAR(255) NOT NULL,
  file_path VARCHAR(500) NOT NULL,
  file_size BIGINT,
  file_type VARCHAR(100),
  uploaded_by VARCHAR(255),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- √çndices
CREATE INDEX idx_attachments_entity ON attachments(entity_type, entity_id);
```

---

## üîó RELACIONAMENTOS ENTRE ENTIDADES

### **üè¢ Relacionamentos Globais (Inter-Tenant)**
```
TENANT (1) ‚Üê‚Üí (N) USER
  ‚Üì
  Cada tenant tem m√∫ltiplos usu√°rios
  Cada usu√°rio pertence a um tenant

ADMIN_USER ‚Üí (independente de tenant)
  ‚Üì
  Acesso global ao sistema
```

### **üìä Relacionamentos Intra-Tenant (Por Schema)**
```
CLIENT (1) ‚Üê‚Üí (N) PROJECT
  ‚Üì
  Um cliente pode ter v√°rios projetos
  Um projeto pertence a um cliente

PROJECT (1) ‚Üê‚Üí (N) TASK
  ‚Üì
  Um projeto pode ter v√°rias tarefas
  Uma tarefa pertence a um projeto

CLIENT (1) ‚Üê‚Üí (N) INVOICE
  ‚Üì
  Um cliente pode ter v√°rias faturas
  Uma fatura pertence a um cliente

CLIENT (1) ‚Üê‚Üí (N) TRANSACTION
PROJECT (1) ‚Üê‚Üí (N) TRANSACTION
  ‚Üì
  Transa√ß√µes podem estar ligadas a clientes e/ou projetos

USER (1) ‚Üê‚Üí (N) PUBLICATION
  ‚Üì
  Publica√ß√µes s√£o isoladas por usu√°rio dentro do tenant

USER (1) ‚Üê‚Üí (N) NOTIFICATION
  ‚Üì
  Notifica√ß√µes s√£o isoladas por usu√°rio

CATEGORY (1) ‚Üê‚Üí (N) TRANSACTION
  ‚Üì
  Uma categoria pode ter v√°rias transa√ß√µes
  Uma transa√ß√£o pertence a uma categoria

ENTITY (1) ‚Üê‚Üí (N) ATTACHMENT
  ‚Üì
  Qualquer entidade pode ter m√∫ltiplos anexos
```

---

## üõ°Ô∏è ESTRAT√âGIAS DE ISOLAMENTO

### **üèóÔ∏è 1. Isolamento por Schema**
```sql
-- Cada tenant tem seu pr√≥prio schema
CREATE SCHEMA tenant_{tenant_id};

-- Todas as tabelas ficam no schema do tenant
CREATE TABLE tenant_{tenant_id}.clients (...);
CREATE TABLE tenant_{tenant_id}.projects (...);
```

### **üë§ 2. Isolamento por Usu√°rio (M√≥dulos Espec√≠ficos)**
```sql
-- Publica√ß√µes e Notifica√ß√µes s√£o isoladas por usu√°rio
SELECT * FROM ${schema}.publications WHERE user_id = $1;
SELECT * FROM ${schema}.notifications WHERE user_id = $1;
```

### **üîç 3. Valida√ß√£o de Acesso**
```typescript
// Middleware garante que req.tenantDB est√° no schema correto
const validateTenantAccess = async (req, res, next) => {
  const user = req.user;
  req.tenantDB = await tenantDB.getTenantDatabase(user.tenantId);
  next();
};
```

### **üö´ 4. Preven√ß√£o de Vazamento de Dados**
```sql
-- Todas as queries s√£o executadas no schema correto
SELECT * FROM ${schema}.clients WHERE is_active = true;

-- Nunca diretamente:
SELECT * FROM clients; -- ‚ùå Perigoso!
```

---

## üîê CONTROLE DE ACESSO POR TIPO DE CONTA

### **üìä SIMPLES**
- ‚úÖ Acesso: Clients, Projects, Tasks, Publications, Notifications
- ‚ùå Bloqueado: Transactions, Invoices (financeiro)

### **üíº COMPOSTA**
- ‚úÖ Acesso: Todos os m√≥dulos
- ‚úÖ Financeiro: Transactions, Invoices
- ‚úÖ Dashboard: M√©tricas completas incluindo financeiras

### **üëë GERENCIAL**
- ‚úÖ Acesso: Todos os m√≥dulos + relat√≥rios avan√ßados
- ‚úÖ Administra√ß√£o: Usu√°rios do tenant
- ‚úÖ Auditoria: Logs e m√©tricas avan√ßadas

---

## üìà INTEGRIDADE REFERENCIAL

### **üîó Foreign Keys Obrigat√≥rias**
```sql
-- Dentro do schema do tenant
ALTER TABLE projects 
ADD CONSTRAINT fk_project_client 
FOREIGN KEY (client_id) REFERENCES clients(id);

ALTER TABLE tasks 
ADD CONSTRAINT fk_task_project 
FOREIGN KEY (project_id) REFERENCES projects(id);

ALTER TABLE tasks 
ADD CONSTRAINT fk_task_client 
FOREIGN KEY (client_id) REFERENCES clients(id);

ALTER TABLE invoices 
ADD CONSTRAINT fk_invoice_client 
FOREIGN KEY (client_id) REFERENCES clients(id);

ALTER TABLE invoices 
ADD CONSTRAINT fk_invoice_project 
FOREIGN KEY (project_id) REFERENCES projects(id);

ALTER TABLE transactions 
ADD CONSTRAINT fk_transaction_client 
FOREIGN KEY (client_id) REFERENCES clients(id);

ALTER TABLE transactions 
ADD CONSTRAINT fk_transaction_project 
FOREIGN KEY (project_id) REFERENCES projects(id);

ALTER TABLE attachments 
ADD CONSTRAINT fk_attachment_entity 
FOREIGN KEY (entity_id) REFERENCES clients(id); -- Exemplo
```

### **‚úÖ Valida√ß√µes de Neg√≥cio**
```typescript
// Sempre validar que os relacionamentos est√£o no mesmo tenant
const project = await projectsService.getProjectById(tenantDB, projectId);
const client = await clientsService.getClientById(tenantDB, project.client_id);

// ‚úÖ Ambos est√£o no mesmo schema automaticamente
```

---

## üîß CAMPOS AUSENTES IDENTIFICADOS NOS UIs

### **üë• Clients**
- ‚úÖ `mobile` - Campo separado de telefone
- ‚úÖ `level` - N√≠vel do cliente (Premium, VIP)
- ‚úÖ `pis`, `cei` - Documentos brasileiros
- ‚úÖ `inss_status` - Status no INSS
- ‚úÖ `amount_paid` - Valor j√° pago
- ‚úÖ `referred_by` - Indicado por
- ‚úÖ `registered_by` - Cadastrado por

### **üìÅ Projects**
- ‚úÖ `name` - Nome separado do t√≠tulo
- ‚úÖ `estimated_value` - Valor estimado
- ‚úÖ `contacts` - Array de contatos complexo
- ‚úÖ `assigned_to` - Array de respons√°veis
- ‚úÖ `due_date` - Data de vencimento

### **üßæ Invoices**
- ‚úÖ `title` - T√≠tulo da fatura
- ‚úÖ `project_id`, `project_name` - Vincula√ß√£o com projeto
- ‚úÖ `client_email`, `client_phone` - Dados espec√≠ficos
- ‚úÖ `items` - Estrutura de itens detalhada
- ‚úÖ `payment_status`, `payment_method` - Status de pagamento
- ‚úÖ `stripe_*` - Integra√ß√£o com Stripe
- ‚úÖ `recorrente` - Faturas recorrentes

### **üìã Publications**
- ‚úÖ `vara_comarca` - Vara/Comarca
- ‚úÖ `nome_pesquisado` - Nome pesquisado
- ‚úÖ `diario` - Di√°rio oficial
- ‚úÖ `urgencia` - N√≠vel de urg√™ncia
- ‚úÖ `atribuida_para_*` - Sistema de atribui√ß√£o

---

## üéØ RESUMO DA ARQUITETURA COMPLETA

1. **üè¢ Tenant**: Unidade de isolamento principal
2. **üë§ User**: Pertence a um tenant, com tipo de conta
3. **üë• Client**: Centro das rela√ß√µes de neg√≥cio (EXPANDIDO)
4. **üìÅ Project**: Ligado a client, cont√©m tasks (EXPANDIDO)
5. **‚úÖ Task**: Parte de um project, com subtarefas (EXPANDIDO)
6. **üí∞ Transaction**: Fluxo de caixa, liga clients/projects
7. **üßæ Invoice**: Faturamento, pertence a client (MUITO EXPANDIDO)
8. **üìã Publication**: Isolado por usu√°rio (EXPANDIDO)
9. **üè∑Ô∏è Category**: Classifica√ß√£o de transa√ß√µes
10. **üîî Notification**: Sistema de notifica√ß√µes (NOVO)
11. **üìä Dashboard_Metric**: M√©tricas calculadas (NOVO)
12. **üìé Attachment**: Sistema de anexos (NOVO)

**üõ°Ô∏è Isolamento Total**: Cada tenant opera em seu pr√≥prio schema, com isolamento adicional por usu√°rio em m√≥dulos espec√≠ficos (publica√ß√µes e notifica√ß√µes), garantindo zero vazamento de dados entre inquilinos.

**üîß Campos Cr√≠ticos Adicionados**: 47 novos campos identificados nos UIs que estavam ausentes na documenta√ß√£o original, incluindo integra√ß√µes com Stripe, sistema de recorr√™ncia, estruturas complexas de contatos e itens, e campos espec√≠ficos da legisla√ß√£o brasileira.
